from unittest.mock import patch
import unittest
from unittest.mock import Mock

from requests.models import Response

import supertool.weather

DIRECTORY = 'supertool_tmp'


class TestGetCoordinatesByAddress(unittest.TestCase):

    the_response = Mock(spec=Response)
    the_response.json.return_value = [{"place_id":"100149","licence":"Data © OpenStreetMap contributors, ODbL 1.0. https:\/\/osm.org\/copyright","osm_type":"node","osm_id":"107775","boundingbox":["51.3473219","51.6673219","-0.2876474","0.0323526"],"lat":"51.5073219","lon":"-0.1276474","display_name":"London, Greater London, England, SW1A 2DU, UK","class":"place","type":"city","importance":0.32637239413505,"icon":"https:\/\/nominatim.openstreetmap.org\/images\/mapicons\/poi_place_city.p.20.png"},{"place_id":"222798502","licence":"Data © OpenStreetMap contributors, ODbL 1.0. https:\/\/osm.org\/copyright","osm_type":"relation","osm_id":"65606","boundingbox":["51.2867602","51.6918741","-0.5103751","0.3340155"],"lat":"51.4893335","lon":"-0.144055090450224","display_name":"London, Greater London, England, UK","class":"place","type":"city","importance":0.32637239413505,"icon":"https:\/\/nominatim.openstreetmap.org\/images\/mapicons\/poi_place_city.p.20.png"},{"place_id":"179694550","licence":"Data © OpenStreetMap contributors, ODbL 1.0. https:\/\/osm.org\/copyright","osm_type":"relation","osm_id":"7485368","boundingbox":["42.824599","43.0730461","-81.3906556","-81.1070784"],"lat":"42.988576","lon":"-81.246643","display_name":"London, Middlesex County, Ontario, Canada","class":"place","type":"city","importance":0.24539307619003,"icon":"https:\/\/nominatim.openstreetmap.org\/images\/mapicons\/poi_place_city.p.20.png"},{"place_id":"179195896","licence":"Data © OpenStreetMap contributors, ODbL 1.0. https:\/\/osm.org\/copyright","osm_type":"relation","osm_id":"130591","boundingbox":["37.079759","37.15226","-84.126262","-84.035957"],"lat":"37.1289771","lon":"-84.0832646","display_name":"London, Laurel County, Kentucky, 40741, United States of America","class":"place","type":"city","importance":0.20882305961122,"icon":"https:\/\/nominatim.openstreetmap.org\/images\/mapicons\/poi_place_city.p.20.png"},{"place_id":"405264","licence":"Data © OpenStreetMap contributors, ODbL 1.0. https:\/\/osm.org\/copyright","osm_type":"node","osm_id":"153408665","boundingbox":["43.0277775","43.0677775","-89.0328881","-88.9928881"],"lat":"43.0477775","lon":"-89.0128881","display_name":"London, Dane County, Wisconsin, United States of America","class":"place","type":"hamlet","importance":0.19695709238775,"icon":"https:\/\/nominatim.openstreetmap.org\/images\/mapicons\/poi_place_village.p.20.png"},{"place_id":"177626907","licence":"Data © OpenStreetMap contributors, ODbL 1.0. https:\/\/osm.org\/copyright","osm_type":"relation","osm_id":"182481","boundingbox":["39.85928","39.921786","-83.478923","-83.389997"],"lat":"39.8864493","lon":"-83.448253","display_name":"London, Madison County, Ohio, 43140, United States of America","class":"place","type":"city","importance":0.19385974542422,"icon":"https:\/\/nominatim.openstreetmap.org\/images\/mapicons\/poi_place_city.p.20.png"},{"place_id":"178712158","licence":"Data © OpenStreetMap contributors, ODbL 1.0. https:\/\/osm.org\/copyright","osm_type":"relation","osm_id":"2730965","boundingbox":["36.4734452","36.4884367","-119.4497699","-119.4385395"],"lat":"36.4760619","lon":"-119.4431785","display_name":"London, Tulare County, California, United States of America","class":"place","type":"village","importance":0.18761308134781,"icon":"https:\/\/nominatim.openstreetmap.org\/images\/mapicons\/poi_place_village.p.20.png"},{"place_id":"179187617","licence":"Data © OpenStreetMap contributors, ODbL 1.0. https:\/\/osm.org\/copyright","osm_type":"relation","osm_id":"111457","boundingbox":["35.315577","35.33814","-93.272693","-93.187375"],"lat":"35.328973","lon":"-93.2529553","display_name":"London, Pope County, Arkansas, United States of America","class":"place","type":"city","importance":0.18711210965545,"icon":"https:\/\/nominatim.openstreetmap.org\/images\/mapicons\/poi_place_city.p.20.png"},{"place_id":"449024","licence":"Data © OpenStreetMap contributors, ODbL 1.0. https:\/\/osm.org\/copyright","osm_type":"node","osm_id":"154301303","boundingbox":["38.1743567","38.2143567","-81.3886944","-81.3486944"],"lat":"38.1943567","lon":"-81.3686944","display_name":"London, Kanawha County, West Virginia, 25110, United States of America","class":"place","type":"hamlet","importance":0.18676962214729,"icon":"https:\/\/nominatim.openstreetmap.org\/images\/mapicons\/poi_place_village.p.20.png"},{"place_id":"54061029","licence":"Data © OpenStreetMap contributors, ODbL 1.0. https:\/\/osm.org\/copyright","osm_type":"node","osm_id":"4240008383","boundingbox":["46.61265","46.65265","5.078175","5.118175"],"lat":"46.63265","lon":"5.098175","display_name":"London, Louhans, Saône-et-Loire, Bourgogne-Franche-Comté, France métropolitaine, 71440, France","class":"place","type":"hamlet","importance":0.17875,"icon":"https:\/\/nominatim.openstreetmap.org\/images\/mapicons\/poi_place_village.p.20.png"}]
    the_response.status_code = 200
    with patch('requests.get', side_effect=the_response):
        def test_correct_address(self):
            expected_output = {"lon": '-0.1276474',
                               "lat": '51.5073219'}
            self.assertEqual(supertool.weather.get_coordinates_by_address('London'), expected_output)

    the_response.json.return_value = []
    with patch('requests.get', side_effect=the_response):
        def test_incorrect_address(self):
            self.assertRaises(LookupError, supertool.weather.get_coordinates_by_address, 'noname town')
